<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS2 Tournament Leaderboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #000000 0%, #141414 100%);
            min-height: 100vh;
            color: #ffffff;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(223, 42, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 167, 0, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .tournament-container {
            max-width: 1900px;
            margin: 0 auto;
            background: rgba(20, 20, 20, 0.95);
            /* border: 2px solid #df2a00; */
            border-radius: 0;
            box-shadow: 
                0 0 30px rgba(223, 42, 0, 0.3),
                inset 0 0 50px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .tournament-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #df2a00, #ffa700, #df2a00);
            animation: pulse-border 2s ease-in-out infinite;
        }

        @keyframes pulse-border {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .tournament-header {
            background: linear-gradient(135deg, #df2a00 0%, #ffa700 100%);
            padding: 25px;
            text-align: center;
            position: relative;
            clip-path: polygon(0 0, 100% 0, 95% 100%, 5% 100%);
        }

        .tournament-title {
            font-size: 2.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            margin-bottom: 10px;
        }

        .tournament-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .podium-section {
            background: #141414;
            padding: 40px 20px;
            border-bottom: 2px solid #df2a00;
        }

        .podium-title {
            text-align: center;
            font-size: 2rem;
            color: #ffa700;
            margin-bottom: 30px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .podium-container {
            display: flex;
            justify-content: center;
            align-items: end;
            gap: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .podium-card {
            background: linear-gradient(135deg, #000000, #141414);
            border: 2px solid;
            padding: 25px 20px;
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .podium-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }

        .podium-first {
            border-color: #ffa700;
            order: 2;
            height: 280px;
            clip-path: polygon(10% 0%, 90% 0%, 100% 15%, 100% 100%, 0% 100%, 0% 15%);
        }

        .podium-second {
            border-color: #c0c0c0;
            order: 1;
            height: 270px;
            clip-path: polygon(15% 0%, 85% 0%, 100% 20%, 100% 100%, 0% 100%, 0% 20%);
        }

        .podium-third {
            border-color: #cd7f32;
            order: 3;
            height: 270px;
            clip-path: polygon(20% 0%, 80% 0%, 100% 25%, 100% 100%, 0% 100%, 0% 25%);
        }

        .podium-rank {
            position: absolute;
            /* top: -15px; */
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: #000000;
        }

        .podium-first .podium-rank {
            background: #ffa700;
        }

        .podium-second .podium-rank {
            background: #c0c0c0;
        }

        .podium-third .podium-rank {
            background: #cd7f32;
        }

        .podium-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 50px auto 15px;
            background: linear-gradient(135deg, #df2a00, #ffa700);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffffff;
            border: 3px solid;
            overflow: hidden;
        }

        .podium-first .podium-avatar {
            border-color: #ffa700;
        }

        .podium-second .podium-avatar {
            border-color: #c0c0c0;
        }

        .podium-third .podium-avatar {
            border-color: #cd7f32;
        }

        .podium-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .podium-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #ffffff;
        }

        .podium-kda {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .podium-first .podium-kda {
            color: #ffa700;
        }

        .podium-second .podium-kda {
            color: #c0c0c0;
        }

        .podium-third .podium-kda {
            color: #cd7f32;
        }

        .stats-bar {
            background: #141414;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #df2a00;
        }

        .stat-item {
            text-align: center;
            color: #ffa700;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffffff;
        }

        .stat-label {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .leaderboard-table {
            background: #000000;
        }

        .table-header {
            display: grid;
            grid-template-columns: 80px 1fr 100px 100px 100px 120px;
            gap: 0;
            background: linear-gradient(135deg, #141414 0%, #000000 100%);
            border-bottom: 2px solid #df2a00;
            position: relative;
        }

        .header-cell {
            padding: 20px 15px;
            text-align: center;
            font-weight: bold;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #ffa700;
            /* border-right: 1px solid rgba(223, 42, 0, 0.3); */
            position: relative;
            
        }

        .header-cell:first-child,
        .header-cell:nth-child(2) {
            text-align: left;
        }

        .header-cell::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 2px;
            background: #df2a00;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .header-cell:hover::after {
            opacity: 1;
        }

        .table-body {
            max-height: 600px;
            overflow-y: auto;
        }

        .table-body::-webkit-scrollbar {
            width: 12px;
        }

        .table-body::-webkit-scrollbar-track {
            background: #141414;
        }

        .table-body::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #df2a00, #ffa700);
            border-radius: 6px;
        }

        .player-row {
            display: grid;
            grid-template-columns: 80px 1fr 100px 100px 100px 120px 150px;
            gap: 0;
            border-bottom: 1px solid rgba(223, 42, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
            background: #000000;
        }

        .player-row:hover {
            background: rgba(223, 42, 0, 0.1);
            transform: translateX(3px);
            box-shadow: inset 3px 0 0 #df2a00;
        }

        .table-cell {
            padding: 18px 15px;
            border-right: 1px solid rgba(223, 42, 0, 0.1);
            display: flex;
            align-items: center;
            font-weight: 500;
        }

        .rank-cell {
            justify-content: flex-start;
        }

        .rank-number {
            background: linear-gradient(135deg, #df2a00, #ffa700);
            color: #ffffff;
            width: 40px;
            height: 40px;
            border-radius: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            clip-path: polygon(15% 0%, 100% 0%, 85% 100%, 0% 100%);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }

        .player-info {
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }

        .player-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            margin-right: 15px;
            background: linear-gradient(135deg, #df2a00, #ffa700);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #ffffff;
            font-size: 1.1rem;
            border: 2px solid #ffa700;
            overflow: hidden;
        }

        .player-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .player-name {
            font-weight: bold;
            font-size: 1.1rem;
            color: #ffffff;
        }

        .stat-cell {
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            color: #ffa700;
        }

        .kda-cell {
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .kda-excellent {
            color: #00ff41;
            text-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
        }

        .kda-good {
            color: #ffa700;
            text-shadow: 0 0 10px rgba(255, 167, 0, 0.5);
        }

        .kda-average {
            color: #ffffff;
        }

        .kda-poor {
            color: #df2a00;
            text-shadow: 0 0 10px rgba(223, 42, 0, 0.5);
        }

        .actions-cell {
            justify-content: center;
            gap: 8px;
        }

        .action-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .edit-btn {
            background: linear-gradient(135deg, #ffa700, #df2a00);
            color: #ffffff;
        }

        .edit-btn:hover {
            background: linear-gradient(135deg, #df2a00, #ffa700);
            transform: translateY(-2px);
        }

        .refer-btn {
            background: linear-gradient(135deg, #00ff41, #00cc33);
            color: #000000;
        }

        .refer-btn:hover {
            background: linear-gradient(135deg, #00cc33, #00ff41);
            transform: translateY(-2px);
        }

        .loading-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 80px;
            background: #000000;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(223, 42, 0, 0.3);
            border-top: 4px solid #df2a00;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: #ffa700;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-container {
            text-align: center;
            padding: 80px;
            background: #000000;
        }

        .error-icon {
            font-size: 4rem;
            color: #df2a00;
            margin-bottom: 20px;
        }

        .error-message {
            color: #ffa700;
            font-size: 1.3rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #141414, #000000);
            margin: 5% auto;
            padding: 30px;
            border: 2px solid #df2a00;
            width: 90%;
            max-width: 500px;
            border-radius: 0;
            clip-path: polygon(5% 0%, 95% 0%, 100% 10%, 100% 100%, 0% 100%, 0% 10%);
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #df2a00;
        }

        .modal-title {
            font-size: 1.5rem;
            color: #ffa700;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .close-btn {
            background: none;
            border: none;
            color: #df2a00;
            font-size: 2rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: #ffa700;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #ffa700;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            background: #000000;
            border: 1px solid #df2a00;
            color: #ffffff;
            font-size: 1rem;
            border-radius: 0;
        }

        .form-input:focus {
            outline: none;
            border-color: #ffa700;
            box-shadow: 0 0 10px rgba(255, 167, 0, 0.3);
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .modal-btn {
            padding: 12px 25px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        .save-btn {
            background: linear-gradient(135deg, #00ff41, #00cc33);
            color: #000000;
        }

        .save-btn:hover {
            background: linear-gradient(135deg, #00cc33, #00ff41);
        }

        .cancel-btn {
            background: linear-gradient(135deg, #df2a00, #ffa700);
            color: #ffffff;
        }

        .cancel-btn:hover {
            background: linear-gradient(135deg, #ffa700, #df2a00);
        }

        @media (max-width: 768px) {
            .podium-container {
                flex-direction: column;
                align-items: center;
            }

            .podium-card {
                order: unset !important;
                height: auto !important;
                min-height: 200px;
                width: 100%;
                max-width: 300px;
            }

            .table-header,
            .player-row {
                grid-template-columns: 50px 1fr 70px 70px 70px 80px;
                gap: 0;
            }

            .header-cell,
            .table-cell {
                padding: 12px 8px;
                font-size: 0.8rem;
            }

            .tournament-title {
                font-size: 2rem;
            }

            .player-avatar {
                width: 35px;
                height: 35px;
                margin-right: 10px;
            }

            .rank-number {
                width: 35px;
                height: 35px;
            }

            .stats-bar {
                flex-wrap: wrap;
                gap: 15px;
            }

            .action-btn {
                padding: 6px 8px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="tournament-container">
        <div class="tournament-header">
            <div class="tournament-title">⚡ CS2 CHAMPIONSHIP ⚡</div>
            <div class="tournament-subtitle">Professional Esports Tournament</div>
        </div>
        
        <div class="podium-section">
            <div class="podium-title">🏆 TOP 3 CHAMPIONS 🏆</div>
            <div class="podium-container" id="podiumContainer">
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Loading Champions...</div>
                </div>
            </div>
        </div>
        
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="totalPlayers">0</div>
                <div class="stat-label">Players</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalKills">0</div>
                <div class="stat-label">Total Kills</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="avgKDA">0.00</div>
                <div class="stat-label">Avg KDA</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">LIVE</div>
                <div class="stat-label">Status</div>
            </div>
        </div>
        
        <div class="leaderboard-table">
            <div class="table-header">
                <div class="header-cell" >Rank</div>
                <div class="header-cell" >Player</div>
                <div class="header-cell" style="margin-left: -320px;">Kill</div>
                <div class="header-cell"style="margin-left: -320px;">Death</div>
                <div class="header-cell"style="margin-left: -320px;">Assist</div>
                <div class="header-cell"style="margin-left: -320px;">KDA</div>
            </div>
            
            <div class="table-body" id="leaderboardBody">
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Loading Tournament Data...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Player Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Edit Player</h2>
                <button class="close-btn" onclick="closeEditModal()">&times;</button>
            </div>
            <form id="editForm">
                <div class="form-group">
                    <label class="form-label">Player Name</label>
                    <input type="text" id="editPlayerName" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Profile Picture URL</label>
                    <input type="url" id="editProfilePic" class="form-input" placeholder="https://example.com/image.jpg">
                </div>
                <div class="form-group">
                    <label class="form-label">Kills</label>
                    <input type="number" id="editKills" class="form-input" min="0" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Deaths</label>
                    <input type="number" id="editDeaths" class="form-input" min="0" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Assists</label>
                    <input type="number" id="editAssists" class="form-input" min="0" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="modal-btn cancel-btn" onclick="closeEditModal()">Cancel</button>
                    <button type="submit" class="modal-btn save-btn">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Refer Friend Modal -->
    <div id="referModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Refer a Friend</h2>
                <button class="close-btn" onclick="closeReferModal()">&times;</button>
            </div>
            <form id="referForm">
                <div class="form-group">
                    <label class="form-label">Friend's Name</label>
                    <input type="text" id="referFriendName" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Friend's Email</label>
                    <input type="email" id="referFriendEmail" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Your Message</label>
                    <input type="text" id="referMessage" class="form-input" placeholder="Join me in this awesome tournament!">
                </div>
                <div class="modal-actions">
                    <button type="button" class="modal-btn cancel-btn" onclick="closeReferModal()">Cancel</button>
                    <button type="submit" class="modal-btn save-btn">Send Invitation</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // API Configuration - Replace with your actual API URLs
        const API_CONFIG = {
            LEADERBOARD_URL: 'YOUR_LEADERBOARD_API_URL_HERE',  // GET request for leaderboard data
            UPDATE_PLAYER_URL: 'YOUR_UPDATE_PLAYER_API_URL_HERE',  // PUT request for updating player
            REFER_FRIEND_URL: 'YOUR_REFER_FRIEND_API_URL_HERE'  // POST request for referring friend
        };

        /*
        Expected API Response Formats:

        1. LEADERBOARD_URL (GET) should return:
        [
            {
                "id": 1,
                "player": "PlayerName",
                "profilePic": "https://example.com/avatar.jpg", // optional
                "kill": 150,
                "death": 45,
                "assist": 89
            },
            // ... more players
        ]

        2. UPDATE_PLAYER_URL (PUT) should accept:
        {
            "id": 1,
            "player": "UpdatedName",
            "profilePic": "https://example.com/new-avatar.jpg",
            "kill": 160,
            "death": 50,
            "assist": 95
        }

        3. REFER_FRIEND_URL (POST) should accept:
        {
            "referrerPlayer": "PlayerName",
            "friendName": "FriendName",
            "friendEmail": "friend@example.com",
            "message": "Join me in this tournament!"
        }
        */

        class CS2LeaderboardManager {
            constructor() {
                this.leaderboardBody = document.getElementById('leaderboardBody');
                this.podiumContainer = document.getElementById('podiumContainer');
                this.totalPlayersEl = document.getElementById('totalPlayers');
                this.totalKillsEl = document.getElementById('totalKills');
                this.avgKDAEl = document.getElementById('avgKDA');
                this.currentEditingPlayer = null;
                this.currentReferringPlayer = null;
                this.playersData = []; // Store current players data
                
                this.loadLeaderboard();
                this.setupEventListeners();
                
                // Auto-refresh every 30 seconds (only in live mode)
                if (!USE_DUMMY_DATA) {
                    setInterval(() => this.loadLeaderboard(), 30000);
                }
            }

            setupEventListeners() {
                // Edit form submission
                document.getElementById('editForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.savePlayerChanges();
                });

                // Refer form submission
                document.getElementById('referForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.sendReferral();
                });

                // Close modals when clicking outside
                window.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal')) {
                        this.closeAllModals();
                    }
                });
            }

            async loadLeaderboard() {
                try {
                    this.showLoading();
                    
                    // Skip API call if using dummy data
                    if (USE_DUMMY_DATA) {
                        return;
                    }
                    
                    const response = await fetch(API_CONFIG.LEADERBOARD_URL, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            // Add any additional headers your API requires
                            // 'Authorization': 'Bearer YOUR_TOKEN',
                            // 'X-API-Key': 'YOUR_API_KEY'
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const playersData = await response.json();
                    this.playersData = playersData; // Store data
                    this.renderPodium(playersData);
                    this.renderLeaderboard(playersData);
                    this.updateStats(playersData);
                    
                } catch (error) {
                    console.error('Error loading leaderboard:', error);
                    this.showError('Connection Failed - Check API Endpoint');
                }
            }

            calculateKDA(kills, deaths, assists) {
                if (deaths === 0) {
                    return kills + assists;
                }
                return ((kills + assists) / deaths).toFixed(2);
            }

            getKDAClass(kda) {
                const kdaValue = parseFloat(kda);
                if (kdaValue >= 3.0) return 'kda-excellent';
                if (kdaValue >= 2.0) return 'kda-good';
                if (kdaValue >= 1.0) return 'kda-average';
                return 'kda-poor';
            }

            getPlayerInitials(playerName) {
                return playerName.split(' ').map(name => name[0]).join('').toUpperCase().slice(0, 2);
            }

            renderPodium(playersData) {
                const sortedPlayers = [...playersData].sort((a, b) => {
                    const kdaA = this.calculateKDA(a.kill, a.death, a.assist);
                    const kdaB = this.calculateKDA(b.kill, b.death, b.assist);
                    return parseFloat(kdaB) - parseFloat(kdaA);
                });

                const top3 = sortedPlayers.slice(0, 3);
                
                if (top3.length === 0) {
                    this.podiumContainer.innerHTML = '<div class="loading-text">No players found</div>';
                    return;
                }

                const podiumHTML = top3.map((player, index) => {
                    const rank = index + 1;
                    const kda = this.calculateKDA(player.kill, player.death, player.assist);
                    const initials = this.getPlayerInitials(player.player);
                    const classes = ['podium-first', 'podium-second', 'podium-third'];
                    
                    return `
                        <div class="podium-card ${classes[index]}">
                            <div class="podium-rank">${rank}</div>
                            <div class="podium-avatar">
                                ${player.profilePic ? 
                                    `<img src="${player.profilePic}" alt="${player.player}" onerror="this.style.display='none'; this.parentElement.textContent='${initials}';">` : 
                                    initials
                                }
                            </div>
                            <div class="podium-name">${player.player}</div>
                            <div class="podium-kda">${kda}</div>
                            <div style="font-size: 0.9rem; color: #888;">
                                ${player.kill}K / ${player.death}D / ${player.assist}A
                            </div>
                        </div>
                    `;
                }).join('');

                this.podiumContainer.innerHTML = podiumHTML;
            }

            updateStats(playersData) {
                const totalPlayers = playersData.length;
                const totalKills = playersData.reduce((sum, player) => sum + player.kill, 0);
                const totalKDAs = playersData.map(player => 
                    parseFloat(this.calculateKDA(player.kill, player.death, player.assist))
                );
                const avgKDA = totalKDAs.length > 0 ? 
                    (totalKDAs.reduce((sum, kda) => sum + kda, 0) / totalKDAs.length).toFixed(2) : '0.00';

                this.totalPlayersEl.textContent = totalPlayers;
                this.totalKillsEl.textContent = totalKills;
                this.avgKDAEl.textContent = avgKDA;
            }

            renderLeaderboard(playersData) {
                const sortedPlayers = [...playersData].sort((a, b) => {
                    const kdaA = this.calculateKDA(a.kill, a.death, a.assist);
                    const kdaB = this.calculateKDA(b.kill, b.death, b.assist);
                    return parseFloat(kdaB) - parseFloat(kdaA);
                });

                const leaderboardHTML = sortedPlayers.map((player, index) => {
                    const rank = index + 1;
                    const kda = this.calculateKDA(player.kill, player.death, player.assist);
                    const kdaClass = this.getKDAClass(kda);
                    const initials = this.getPlayerInitials(player.player);

                    return `
                        <div class="player-row">
                            <div class="table-cell rank-cell">
                                <div class="rank-number">${rank}</div>
                            </div>
                            <div class="table-cell player-info">
                                <div class="player-avatar">
                                    ${player.profilePic ? 
                                        `<img src="${player.profilePic}" alt="${player.player}" onerror="this.style.display='none'; this.parentElement.textContent='${initials}';">` : 
                                        initials
                                    }
                                </div>
                                <div class="player-name">${player.player}</div>
                            </div>
                            <div class="table-cell stat-cell">${player.kill}</div>
                            <div class="table-cell stat-cell">${player.death}</div>
                            <div class="table-cell stat-cell">${player.assist}</div>
                            <div class="table-cell kda-cell ${kdaClass}">${kda}</div>
                        </div>
                    `;
                }).join('');

                this.leaderboardBody.innerHTML = leaderboardHTML;
            }

            openEditModal(player) {
                this.currentEditingPlayer = player;
                document.getElementById('editPlayerName').value = player.player;
                document.getElementById('editProfilePic').value = player.profilePic || '';
                document.getElementById('editKills').value = player.kill;
                document.getElementById('editDeaths').value = player.death;
                document.getElementById('editAssists').value = player.assist;
                document.getElementById('editModal').style.display = 'block';
            }

            openReferModal(playerName) {
                this.currentReferringPlayer = playerName;
                document.getElementById('referFriendName').value = '';
                document.getElementById('referFriendEmail').value = '';
                document.getElementById('referMessage').value = `Join me in this awesome CS2 tournament! - ${playerName}`;
                document.getElementById('referModal').style.display = 'block';
            }

            async savePlayerChanges() {
                try {
                    const updatedPlayer = {
                        id: this.currentEditingPlayer.id,
                        player: document.getElementById('editPlayerName').value,
                        profilePic: document.getElementById('editProfilePic').value,
                        kill: parseInt(document.getElementById('editKills').value),
                        death: parseInt(document.getElementById('editDeaths').value),
                        assist: parseInt(document.getElementById('editAssists').value)
                    };

                    if (USE_DUMMY_DATA) {
                        // Demo mode: Update local data
                        const playerIndex = this.playersData.findIndex(p => p.id === updatedPlayer.id);
                        if (playerIndex !== -1) {
                            this.playersData[playerIndex] = updatedPlayer;
                            this.renderPodium(this.playersData);
                            this.renderLeaderboard(this.playersData);
                            this.updateStats(this.playersData);
                        }
                        alert('Player updated successfully! (Demo Mode)');
                        this.closeEditModal();
                        return;
                    }

                    // Live mode: Make API call
                    const response = await fetch(API_CONFIG.UPDATE_PLAYER_URL, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            // Add any additional headers your API requires
                        },
                        body: JSON.stringify(updatedPlayer)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    alert('Player updated successfully!');
                    this.closeEditModal();
                    this.loadLeaderboard(); // Refresh data
                    
                } catch (error) {
                    console.error('Error updating player:', error);
                    alert('Failed to update player. Please try again.');
                }
            }

            async sendReferral() {
                try {
                    const referralData = {
                        referrerPlayer: this.currentReferringPlayer,
                        friendName: document.getElementById('referFriendName').value,
                        friendEmail: document.getElementById('referFriendEmail').value,
                        message: document.getElementById('referMessage').value
                    };

                    if (USE_DUMMY_DATA) {
                        // Demo mode: Just show success message
                        alert(`Invitation sent successfully! (Demo Mode)\n\nFriend: ${referralData.friendName}\nEmail: ${referralData.friendEmail}\nMessage: ${referralData.message}`);
                        this.closeReferModal();
                        return;
                    }

                    // Live mode: Make API call
                    const response = await fetch(API_CONFIG.REFER_FRIEND_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            // Add any additional headers your API requires
                        },
                        body: JSON.stringify(referralData)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    alert('Invitation sent successfully!');
                    this.closeReferModal();
                    
                } catch (error) {
                    console.error('Error sending referral:', error);
                    alert('Failed to send invitation. Please try again.');
                }
            }

            closeEditModal() {
                document.getElementById('editModal').style.display = 'none';
                this.currentEditingPlayer = null;
            }

            closeReferModal() {
                document.getElementById('referModal').style.display = 'none';
                this.currentReferringPlayer = null;
            }

            closeAllModals() {
                this.closeEditModal();
                this.closeReferModal();
            }

            showLoading() {
                this.leaderboardBody.innerHTML = `
                    <div class="loading-container">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">Loading Tournament Data...</div>
                    </div>
                `;
                
                this.podiumContainer.innerHTML = `
                    <div class="loading-container">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">Loading Champions...</div>
                    </div>
                `;
            }

            showError(message) {
                this.leaderboardBody.innerHTML = `
                    <div class="error-container">
                        <div class="error-icon">⚠️</div>
                        <div class="error-message">${message}</div>
                    </div>
                `;
                
                this.podiumContainer.innerHTML = `
                    <div class="error-container">
                        <div class="error-icon">⚠️</div>
                        <div class="error-message">${message}</div>
                    </div>
                `;
            }
        }

        // Global functions for modal controls
        function closeEditModal() {
            leaderboard.closeEditModal();
        }

        function closeReferModal() {
            leaderboard.closeReferModal();
        }

        // Initialize the leaderboard when the page loads
        let leaderboard;
        document.addEventListener('DOMContentLoaded', () => {
            leaderboard = new CS2LeaderboardManager();
        });

        // Sample data for testing (remove this when connecting to real API)
        const sampleData = [
            { 
                id: 1, 
                player: "s1mple", 
                profilePic: "https://via.placeholder.com/100x100/ff6b6b/ffffff?text=S1", 
                kill: 287, 
                death: 156, 
                assist: 89 
            },
            { 
                id: 2, 
                player: "ZywOo", 
                profilePic: "https://via.placeholder.com/100x100/4ecdc4/ffffff?text=ZY", 
                kill: 245, 
                death: 134, 
                assist: 156 
            },
            { 
                id: 3, 
                player: "NiKo", 
                profilePic: "", 
                kill: 234, 
                death: 145, 
                assist: 134 
            },
            { 
                id: 4, 
                player: "device", 
                profilePic: "https://via.placeholder.com/100x100/45b7d1/ffffff?text=DV", 
                kill: 198, 
                death: 123, 
                assist: 98 
            },
            { 
                id: 5, 
                player: "sh1ro", 
                profilePic: "", 
                kill: 189, 
                death: 134, 
                assist: 145 
            },
            { 
                id: 6, 
                player: "Ax1Le", 
                profilePic: "https://via.placeholder.com/100x100/96ceb4/ffffff?text=AX", 
                kill: 167, 
                death: 156, 
                assist: 123 
            },
            { 
                id: 7, 
                player: "electronic", 
                profilePic: "", 
                kill: 156, 
                death: 167, 
                assist: 89 
            },
            { 
                id: 8, 
                player: "Perfecto", 
                profilePic: "https://via.placeholder.com/100x100/feca57/ffffff?text=PF", 
                kill: 134, 
                death: 145, 
                assist: 178 
            },
            { 
                id: 9, 
                player: "b1t", 
                profilePic: "", 
                kill: 145, 
                death: 134, 
                assist: 156 
            },
            { 
                id: 10, 
                player: "Hobbit", 
                profilePic: "https://via.placeholder.com/100x100/ff9ff3/ffffff?text=HB", 
                kill: 123, 
                death: 145, 
                assist: 134 
            }
        ];
        
        // DEMO MODE: Using dummy data for demonstration
        // To switch to LIVE API mode, change USE_DUMMY_DATA to false and add your API URLs above
        const USE_DUMMY_DATA = true;
        
        if (USE_DUMMY_DATA) {
            // For demo, load dummy data after 2 seconds
            setTimeout(() => {
                leaderboard.renderPodium(sampleData);
                leaderboard.renderLeaderboard(sampleData);
                leaderboard.updateStats(sampleData);
                leaderboard.playersData = sampleData; // Store for modal operations
            }, 2000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'972226439232403d',t:'MTc1NTY5NTYyMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
